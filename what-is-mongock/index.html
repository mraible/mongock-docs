<!doctype html><html data-current="page" lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>What is Mongock?</title><meta name="description" content="Everything you need to have Mongock working and shining"><link rel="stylesheet" href="/style.css?v=1633770457082"><link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’¥</text></svg>"><script defer="defer">function logout(){localStorage.removeItem("passphrase"),window.location.href="/"}function showNavigation(){const e=document.getElementById("navigation");e.classList.remove("hidden","sticky","pt-32"),e.classList.add("absolute","right-0","top-0","-mt-0","z-50","pt-0","bg-white","border-l","border-gray-200")}function closeNavigation(){const e=document.getElementById("navigation");e.classList.add("hidden"),e.classList.remove("absolute","right-0","z-50","bg-gray-100","border-r","border-gray-800")}function activateDarkMode(){"true"===localStorage.getItem("darkmode")?(localStorage.setItem("darkmode","false"),document.body.classList.remove("dark")):(localStorage.setItem("darkmode","true"),document.body.classList.add("dark"))}window.netlifyIdentity&&window.netlifyIdentity.on("init",e=>{e||window.netlifyIdentity.on("login",()=>{document.location.href="/admin/"})}),document.addEventListener("DOMContentLoaded",function(){document.getElementById("main").addEventListener("click",closeNavigation,!1),"true"===localStorage.getItem("darkmode")?document.body.classList.add("dark"):document.body.classList.remove("dark")}),function(e,t){"use strict";const d=d=>{const n=e.searchIndex.search(d.target.value,{bool:"OR",expand:!0}),a=t.getElementById("searchField"),o=t.getElementById("searchResults"),s=t.getElementById("noResultsFound");t.getElementById("navigation");a.addEventListener("focus",e=>{e.target.classList.remove("hidden"),o.classList.remove("hidden")}),t.addEventListener("click",function(e){a.contains(e.target)||(console.log("hidden"),o.classList.add("hidden"),s.classList.add("hidden"),s.classList.add("hidden"))}),o.innerHTML="",""!=d.target.value?""!=n?(s.classList.add("hidden"),o.classList.add("p-4"),n.map(e=>{const{id:d,title:n,description:a}=e.doc,s=t.createElement("li",{tabindex:"-1"});o.appendChild(s);const i=t.createElement("h3");s.appendChild(i);const c=t.createElement("a");c.setAttribute("href",d),c.textContent=n,i.appendChild(c);const l=t.createElement("p");l.textContent=a,s.appendChild(l)})):s.classList.remove("hidden"):s.classList.add("hidden")};fetch("/search-index.json").then(n=>n.json().then(n=>{e.searchIndex=elasticlunr.Index.load(n),t.getElementById("searchField").addEventListener("input",d)}))}(window,document);</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/elasticlunr/0.9.6/elasticlunr.min.js" defer="defer"></script></head><body><div id="app" class="h-screen bg-white dark:bg-gray-900"><h1>asdasd</h1><div class="fixed w-full top-0 left-0 z-10"><nav class="flex h-16 md:h-20 items-center bg-white dark:bg-gray-900 z-20 fixed top-0 left-0 right-0 border-b border-gray-100 px-0 py-2 dark:bg-dark dark:border-gray-800 transition-colors duration-200"><div class="hidden md:block space-y-4 w-full p-4"><a class="no-underline text-gray-600 hover:text-gray-800 font-bold dark:text-gray-500 items-center" href="/"><span class="text-xl">Mongock documentation</span> <span class="block mt-1 text-sm text-gray-500 hover:text-gray-600 dark:text-gray-600 font-normal text-xs sm:text-xs md:text-sm lg:text-sm w-full">ðŸ’¥ðŸ’¥ðŸ’¥ðŸ’¥ðŸ’¥ðŸ’¥</span></a></div><div class="mr-3"><a aria-label="github link" rel="noopener noreferrer" href="http://github.com/mongock/mongock-docs" target="_blank"><svg height="28" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" class="text-gray-400 dark:text-gray-400" d="M12 3C7.0275 3 3 7.12937 3 12.2276C3 16.3109 5.57625 19.7597 9.15374 20.9824C9.60374 21.0631 9.77249 20.7863 9.77249 20.5441C9.77249 20.3249 9.76125 19.5982 9.76125 18.8254C7.5 19.2522 6.915 18.2602 6.735 17.7412C6.63375 17.4759 6.19499 16.6569 5.8125 16.4378C5.4975 16.2647 5.0475 15.838 5.80124 15.8264C6.51 15.8149 7.01625 16.4954 7.18499 16.7723C7.99499 18.1679 9.28875 17.7758 9.80625 17.5335C9.885 16.9337 10.1212 16.53 10.38 16.2993C8.3775 16.0687 6.285 15.2728 6.285 11.7432C6.285 10.7397 6.63375 9.9092 7.20749 9.26326C7.1175 9.03257 6.8025 8.08674 7.2975 6.81794C7.2975 6.81794 8.05125 6.57571 9.77249 7.76377C10.4925 7.55615 11.2575 7.45234 12.0225 7.45234C12.7875 7.45234 13.5525 7.55615 14.2725 7.76377C15.9937 6.56418 16.7475 6.81794 16.7475 6.81794C17.2424 8.08674 16.9275 9.03257 16.8375 9.26326C17.4113 9.9092 17.76 10.7281 17.76 11.7432C17.76 15.2843 15.6563 16.0687 13.6537 16.2993C13.98 16.5877 14.2613 17.1414 14.2613 18.0065C14.2613 19.2407 14.25 20.2326 14.25 20.5441C14.25 20.7863 14.4188 21.0746 14.8688 20.9824C16.6554 20.364 18.2079 19.1866 19.3078 17.6162C20.4077 16.0457 20.9995 14.1611 21 12.2276C21 7.12937 16.9725 3 12 3Z" fill="currentColor"></path></svg></a></div><div class="mr-2 relative w-full md:w-64"><input aria-label="Search" x-data="{ isOpen: true }" x-bind:class="{ 'hidden': !isOpen }" type="search" placeholder="Search..." class="ml-2 w-60 bg-gray-50 dark:bg-gray-800 appearance-none border dark:border-gray-700 rounded py-2 px-2 placeholder-gray-300 leading-tight focus:ring-4 focus:ring-blue-200 dark:focus:ring-gray-700 ring-opacity-50 border-gray-200" id="searchField"><ul tabindex="0" class="bg-white dark:bg-gray-200 z-50 shadow-md p-0 w-full list-none m-0 absolute left-0 md:right-0 bg-white rounded mt-1 top-100 z-50" id="searchResults"></ul><div class="hidden shadow-md list-none p-4 m-0 absolute left-0 md:right-0 bg-white rounded mt-1 border top-100 divide-y divide-gray-300 z-2" id="noResultsFound"><p>No results found.</p></div></div><button aria-label="Show navigation" onclick="showNavigation()" class="block md:hidden mr-3"><svg fill="none" width="24" height="24" viewBox="0 0 24 24" class="text-gray-400 hover:text-gray-600" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg></button> <a aria-label="dark mode" rel="noopener noreferrer" class="ml-2 mr-3 switch text-current cursor-pointer" onclick="activateDarkMode()"><svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16" height="24" xmlns="http://www.w3.org/2000/svg"><path class="text-gray-400 hover:text-yellow-400 dark:text-yellow-400" fill-rule="evenodd" clip-rule="evenodd" d="M11.67 8.658a3.661 3.661 0 0 0-.781 1.114 3.28 3.28 0 0 0-.268 1.329v1.6a1.304 1.304 0 0 1-.794 1.197 1.282 1.282 0 0 1-.509.102H7.712a1.285 1.285 0 0 1-.922-.379 1.303 1.303 0 0 1-.38-.92v-1.6c0-.479-.092-.921-.274-1.329a3.556 3.556 0 0 0-.776-1.114 4.689 4.689 0 0 1-1.006-1.437A4.187 4.187 0 0 1 4 5.5a4.432 4.432 0 0 1 .616-2.27c.197-.336.432-.64.705-.914a4.6 4.6 0 0 1 .911-.702c.338-.196.7-.348 1.084-.454a4.45 4.45 0 0 1 1.2-.16 4.476 4.476 0 0 1 2.276.614 4.475 4.475 0 0 1 1.622 1.616 4.438 4.438 0 0 1 .616 2.27c0 .617-.117 1.191-.353 1.721a4.69 4.69 0 0 1-1.006 1.437zM9.623 10.5H7.409v2.201c0 .081.028.15.09.212a.29.29 0 0 0 .213.09h1.606a.289.289 0 0 0 .213-.09.286.286 0 0 0 .09-.212V10.5z"></path></svg></a></nav></div><nav id="navigation" class="fixed inset-y-0 overflow-x-hidden overflow-y-auto hidden w:64 lg:w-72 mt-20 md:block dark:bg-gray-900 flex-none top-0 p-4 w-64 md:border-r border-b border-gray-100 dark:border-gray-800"><select name="cars" id="cars"><option value="v4">Version 4</option><option value="v5" selected="true">Version 5</option></select> <button name="Close navigation" onclick="closeNavigation()" class="float-right justify-end block md:hidden -mr-4 p-6"><svg xmlns="http://www.w3.org/2000/svg" class="dark:bg-gray-500" width="18" height="18" viewBox="0 0 18 18"><path class="text-gray-100" d="M14.53 4.53l-1.06-1.06L9 7.94 4.53 3.47 3.47 4.53 7.94 9l-4.47 4.47 1.06 1.06L9 10.06l4.47 4.47 1.06-1.06L10.06 9z"/></svg></button><div class="clear-right"><a href="/"><div class="block md:hidden pt-4 font-semibold text-gray-500">Mongock documentation</div><div class="block md:hidden text-sm text-gray-500 mb-4">ðŸ’¥ðŸ’¥ðŸ’¥ðŸ’¥ðŸ’¥ðŸ’¥</div></a><ul class="nav"><li class="item active"><a href="/what-is-mongock/" class="item active">What is Mongock?</a></li><li class="item"><a href="/technical-overview/" class="item">Technical overview</a></li><li class="item"><a href="/get-started/" class="item">Get started</a></li><li class="item"><a href="/migration/" class="item">Migration</a></li><li class="item"><a href="/runner/" class="item">Runner</a><ul><li class="item"><a href="/runner/standalone/" class="item">Standalone</a></li><li class="item"><a href="/runner/springboot/" class="item">Springboot</a></li></ul></li><li class="item"><a href="/driver/" class="item">Driver</a><ul><li class="item"><a href="/driver/mongodb/" class="item">MongoDB</a></li></ul></li><li class="item"><a href="/features/" class="item">Features</a><ul><li class="item"><a href="/features/transactions/" class="item">Transactions</a></li><li class="item"><a href="/features/events/" class="item">Events</a></li><li class="item"><a href="/features/legacy-migration/" class="item">Legacy migration</a></li></ul></li><li class="item"><a href="/roadmap/" class="item">Mongock Roadmap</a></li><li class="item"><a href="/faq/" class="item">FAQ</a></li><li class="item"><a href="/pending/" class="item">Pending</a></li></ul></div></nav><main id="main" class="dark:bg-gray-900 pt-16 sm:pt-18 md:pt-20 md:pl-64 lg:pl-72"><div class="flex mt-4 justify-end mr-1"><div class="inline-block w-auto text-xs text-gray-500 pt-1 pb-1 pl-3 mr-2 rounded">Updated <time datetime="2021-10-09">Oct 09, 2021</time></div></div><div class="flex w-full justify-center"><div class="mt-4 px-6 md:px-6 lg:px-8 xl:px-12 w-full max-w-5xl"><div class="wrapper flex justify-between"><div class="main flex flex-col pr-0 prose sm:prose lg:prose-lg xl:prose-md"><article><h1 class="dark:text-gray-500">What is Mongock?</h1><div class="self-center adjust dark:text-gray-400"><ol><li><a href="#introduction">Introduction</a></li><li><a href="#why-mongock%3F">Why Mongock?</a></li><li><a href="#how-it-works">How it works</a></li></ol><h2 id="introduction">Introduction</h2><p>Mongock is a Java based Migration tool as part of your Application code. It allows Developers to have ownership and control over Data migrations during the deployment process, allowing safer migrations in Distributed Systems as code and data changes are shipped together.</p><p>It was originally designed for MongoDB Data migrations and the product is evolving to provide a wider suite of NoSQL / SQL Database compatibility and cover other feautures for transactional execution use cases that require state management in Distributed systems.</p><hr><h2 id="why-mongock%3F">Why Mongock?</h2><p>Our mission is to enable Developers to deploy and manage stateful Data migrations in Distributed Systems in a safe and reliable manner. If you are looking for migrating data for your Java Application Services in a safe and reliable manner via Code, Mongock is your best bet.</p><p>In a nutshell:</p><ul><li>Mongock is a Java-based tool that you can import in your Application.</li><li>Mongock promotes a Code-first approach for Migrations, allowing developers to write migration scripts in Java which ship with the Application code. This enables Code and Database changes to ship together.</li><li>Mongock persists in your Database the changes made. This allows Developers to gain more control over the management of changes via Migrations, Rollbacks + other amazing features.</li><li>It is the most reliable production-grade solution for MongoDB migrations currently in the market, compatible with Mongo Atlas and different MongoDB versions.</li><li>Mongock is used in Distributed Systems as the solution implements a solid locking mechanism.</li><li>Our team offers great support and is very responsive.</li><li>We are an open source tool, operating under the Apache License 2.0</li><li>We maintain and update features regularly.</li><li>Currently, Mongock is used by several tech companies in different industries.</li><li>Adopted by well-known frameworks such as JHipster as part of the scaffolding.</li><li>Can be used together with most, if not all, frameworks.</li><li>Can run in Standalone projects without depending on frameworks.</li><li>Great support with the Spring framework overall, with native implementations in SpringBoot.</li></ul><p>Get more information about our support model at <a href="mailto:dev@cloudyrock.xn--io-h1t" target="_blank" rel="noopener noreferrer">dev@cloudyrock.ioâ€‹</a> and we can help you walking you to production.</p><hr><h2 id="how-it-works">How it works</h2><h3 id="1.-scenario">1. Scenario</h3><p>Lets describe a scenario where the use of Mongock plays a big role:</p><p>We have a microservice called <strong>client-service</strong>, which uses the table/collection <code>clients</code></p><p>As part of the development, we have a new User Story which requires your application to get some clients data from a third party system and persist them into database, in the <code>clients</code> table/collection. This is only required once and must be performed as part of the release.</p><p>In addition, the <strong>client-service</strong> is deployed in a Distributed environment running with more than one node and with horizontal scaling.</p><h3 id="2.-your-migration-changes-(changeunit)">2. Your migration changes (<a href="/migration/">ChangeUnit</a>)</h3><p>We first need to implement the migration to retrieve the data from the third party system and persist it in the database. For this we use the ChangeUnit, which is Mongockâ€™s unit of Migration. This will be where we write the code.</p><div class="successAlt"><b>Note:</b> From version 5, ChangeLog annotation is deprecated (though remains for backwards compatibility). It's been replaced by <b>@ChangeUnit</b>.</div><p>Please, visit the <a href="/migration/">ChangeUnit section</a> for more information.</p><h3 id="3.-the-persistent-layer-(driver)">3. The persistent layer (<a href="/driver/">Driver</a>)</h3><p>We need to access the database for multiple reasons:</p><ul><li>To persist the client data we just retrieved.</li><li>Mongock needs to track the ChangeUnits that have been executed, so the <strong>client-service</strong> doesnâ€™t execute them twice.<br>â€“ As more than one instance of the client-service may be running simultaneusly in the environment, it will try to execute the same migration on startup. To prevent this, Mongock uses a pesimistic lock that is persisted in database.<br>â€“ In addition, this allows Mongock to store a history of changes and execute Rollbacks, amongst other operations.</li></ul><p>For allowing Mongock to access the Database and persist state changes, we will use the <strong>Mongock Driver</strong>. The driver contains all the information and mechanisms to access to the database. Mongock provides multiple drivers for different databases. The developers can choose the most suitable and configure the driver by providing some information like the the target schema, etc.</p><p>Please, visit the <a href="/driver/">Driver section</a> for more information.</p><h3 id="4.-run-the-migration">4. Run the migration</h3><p>Once we have implemented our migration in our changelog and configured the persistent layer using a Mongock driver, we need to run the migration. For this, we will use the <strong>Mongock Runner</strong>.</p><p>The Mongock Runner orchestrates the configurations, environment/framework settings, the driver and the ChangeUnits and runs all migrations in an orderly manner. The most common use case is that the application wonâ€™t start until the migration has been succesfully finalized (although this behaviour can be altered). This means that if the list of migrations fail, the application will stop its startup process and exit. This will be retried again in the next startup and Mongock will continue the migration where it left.</p><p>Mongock provides multiple runners for framework compatibility: for standalone applications, Springboot, Micronaut(coming soon), etc.</p><p>Please, visit the <a href="/runner/">Runner section</a> for more information.</p><p>Great, we have the migration done, tested, deployed and working nicely. Awesome ðŸŽ‰</p><p>For a more in-depth description of Mongock, please visit the <a href="/technical-overview">Technical Overview</a> section</p><h3 id="%E2%80%A6-cool%2C-but-we-got-a-new-user-story!-%3Ascream%3A">â€¦ Cool, but we got a new user story! ðŸ˜±</h3><p>But now a new User Story has arrived where it requires us to add a new field. Well, we already have Mongock setup, all it requires is to create another ChangeUnit to address this change in the same way we did previously. Donâ€™t worry, Mongock will take care of running only the ChangeUnits that havenâ€™t been executed yet.</p><p class="noteAlt">Note that a <b>ChangeUnit</b> represents a unit of migration, which means that each ChangeUnit is wrapped in a <b>transaction</b>. As soon as it's finished, it's commited.</p><h3 id="%E2%80%A6-other-ways-of-running-mongock">â€¦ other ways of running Mongock</h3><p>The explained way of running Mongock is the common and traditional use case. However, Mongock offers more.</p><p>You can use the <strong>Mongock CLI</strong> to run the same migration, but also other operations like undo, list and more supported operations. The purpose is to provide a flexible manner of executing migrations.</p><p>Please, visit the <a href="/cli/">CLI section</a> for more information.</p><ul class="footer-nav pt-4 mb-8 ml-0 pl-0 flex flex-wrap flex-row-reverse justify-between mt-8 list-none"><li class="ml-0 pl-0"><a class="font-semibold text-gray-500 hover:text-gray-900" href="/technical-overview/">Technical overview</a> <svg height="24" fill="none" viewBox="0 0 24 24" stroke="#6B7280" class="inline ml-1 flex-shrink-0"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg></li></ul></div></article></div></div></div></div><div class="z-50 mt-12 h-12 flex dark:bg-gray-900 text-gray-500 dark:text-gray-400 justify-center p-2 border-t border-gray-100 dark:border-gray-800"><div class="flex w-full items-center"><div class="w-6 h-6 flex-none"></div><div class="text-gray-500 flex flex-grow justify-center text-align-center"><small>Mongock team</small></div><div class="flex-none ml-2 float-right"><a aria-label="github link" rel="noopener noreferrer" href="http://github.com/cloudyrock/eleventy-poc" target="_blank"><svg height="28" viewBox="0 0 24 24" fill="none"><path fill-rule="evenodd" clip-rule="evenodd" class="text-gray-400 dark:text-gray-400" d="M12 3C7.0275 3 3 7.12937 3 12.2276C3 16.3109 5.57625 19.7597 9.15374 20.9824C9.60374 21.0631 9.77249 20.7863 9.77249 20.5441C9.77249 20.3249 9.76125 19.5982 9.76125 18.8254C7.5 19.2522 6.915 18.2602 6.735 17.7412C6.63375 17.4759 6.19499 16.6569 5.8125 16.4378C5.4975 16.2647 5.0475 15.838 5.80124 15.8264C6.51 15.8149 7.01625 16.4954 7.18499 16.7723C7.99499 18.1679 9.28875 17.7758 9.80625 17.5335C9.885 16.9337 10.1212 16.53 10.38 16.2993C8.3775 16.0687 6.285 15.2728 6.285 11.7432C6.285 10.7397 6.63375 9.9092 7.20749 9.26326C7.1175 9.03257 6.8025 8.08674 7.2975 6.81794C7.2975 6.81794 8.05125 6.57571 9.77249 7.76377C10.4925 7.55615 11.2575 7.45234 12.0225 7.45234C12.7875 7.45234 13.5525 7.55615 14.2725 7.76377C15.9937 6.56418 16.7475 6.81794 16.7475 6.81794C17.2424 8.08674 16.9275 9.03257 16.8375 9.26326C17.4113 9.9092 17.76 10.7281 17.76 11.7432C17.76 15.2843 15.6563 16.0687 13.6537 16.2993C13.98 16.5877 14.2613 17.1414 14.2613 18.0065C14.2613 19.2407 14.25 20.2326 14.25 20.5441C14.25 20.7863 14.4188 21.0746 14.8688 20.9824C16.6554 20.364 18.2079 19.1866 19.3078 17.6162C20.4077 16.0457 20.9995 14.1611 21 12.2276C21 7.12937 16.9725 3 12 3Z" fill="currentColor"></path></svg></a></div></div></div></main></div></body></html>